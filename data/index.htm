<!DOCTYPE html>
<html>

<head>
	<title>Sous Vide Control</title>
	<script src="jquery-3.2.1.min.js"></script>
	<script>

		var tRefresh = 0;
		setInterval(function(){
			$('#tRefresh').html("Last updated "+(tRefresh++)+" seconds ago").css('color',(tRefresh>10 && (tRefresh%2==0)?'red':'black'));
		}, 1000);

		function setIntervalI(fn, t){
			fn();
			return setInterval(fn, t);
		}

		$( document ).ready(function() {

			$('#setTempForm').submit(function(e){
				e.preventDefault();
				$('#currentSetTemp').html("...");
				$.post("/io",$(this).serialize()).done(updateDisplay);
			});

			window.setIntervalI(function(){
				$.get("/io",updateDisplay);
			},5000);

		});

		function updateDisplay(data){
			tRefresh=0;
			$('#currentSetTemp').html(data.setTemp);
			$("#power").html(data.power);
			$("#temperature").html(data.temperature);
			$("#running").html(data.running?"On":"Off");
			var date = new Date(null);
			date.setSeconds(data.upTime/1000); // specify value for SECONDS here
			var result = date.toISOString().substr(11, 8);
			$("#upTime").html(result);
		}

	</script>
	<style>

		body {width:100%; height:100%; margin:0;}
		@media only screen and (max-width: 768px) {
			body {
				font-size: 20px;
			}
		}

		@media only screen and (max-width: 320px) {
			body {
				font-size: 10px;
			}
		}
	</style>
</head>

<body>
Current Set Point: <span id="currentSetTemp"></span>
<form id="setTempForm">
	<input type="number" name="setTemp" step=".1" min="0"/>
	<input type="submit" value="Set"/>
</form>

Current Temp: <span id="temperature"></span><br>
Power Level: <span id="power"></span><br>
Running: <span id="running"></span><br>
Time @ Temp: <span id="upTime"></span><br>
<span style="font-size: .75em" id="tRefresh"></span>

<br>
<a href="/wifi.htm">WiFi Settings</a>



</body>

</html>