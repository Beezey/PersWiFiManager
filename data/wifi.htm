<!DOCTYPE html>
<html>

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />				
	<title>Sous Vide WiFi</title>
	<script src="jquery-3.2.1.min.js"></script>
	<script>
		var w = {};

		updateWifiList = function () {
			$.get("/wifi/list.json", function (data) {
				$('#wifistatus').html((data.connected?("Connected to "+data.connected):"Not connected"));
				$(data.networks).each(function (i, e) {
					$("<span></span>").html(e.ssid)
						.append('<br>')
						.append(((e.encrypted) ? "\uD83D\uDD12 " : "\u26a0 ") + "\uD83D\uDCF6=" + e.signal)
						.addClass('rbutton')
						.click(function () {
							w.ssidn = i;
							if (e.encrypted) {
								w.password = prompt("Enter password for " + e.ssid);
								if (w.password == null) return;
							}
							if (confirm("Connect to " + e.ssid + "?")) $.post('/wifi/connect', w);

						})
						.appendTo('#wifilist');
				});
			});
		};

		$(document).ready(function () {
			$.ajaxSetup({timeout:900000});
			$('#loadnav').load('index.htm #nav');
			updateWifiList();

			$('#manual').click(function () {
				w = {};
				w.ssid = prompt("Enter network name");
				if (w.ssid == null) return;
				var p = prompt("Enter password (blank for open wifi");
				if (p == null) return;
				if (p.length) w.password = p;
				if (confirm("Connect to " + w.ssid + "?")) $.post('/wifi/connect', w);
			});

			$('#wps').click(function () {
				if (confirm("Start WPS setup?")) $.post('/wifi/wps');
			});
		});
	</script>

	<link rel="stylesheet" type="text/css" href="style.css">

</head>

<body>

	<div id="main">
		WiFi Status: <br>
		<span id="wifistatus" class="smalltext">Loading...</span><br>
		<span class="smalltext">Changing WiFi settings will reboot the device.</span>
		<br>
		WiFi Networks:
		<div id="wifilist"></div><br>
		<span id="manual" class='rbutton'>Manual</span>
		<span id="wps" class='rbutton'>WPS Setup<br>
		</span>
		<br>
		<div id="loadnav"></div>
	</div>


</body>

</html>